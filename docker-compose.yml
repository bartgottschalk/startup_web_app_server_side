# Docker Compose for StartupWebApp - Full Stack Development Environment
# Note: version field removed as it's obsolete in Docker Compose v2+

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: startupwebapp-backend-dev
    ports:
      - "8000:8000"
      - "60767:60767"  # LiveServerTestCase API port for functional tests
    volumes:
      # Mount source code for hot-reloading during development
      - ./StartupWebApp:/app
      # Persist database between restarts
      - sqlite_data:/app/data
    environment:
      - DJANGO_SETTINGS_MODULE=StartupWebApp.settings
      - DEBUG=True
      - PYTHONUNBUFFERED=1
      - DOCKER_ENV=true  # Flag to indicate running in Docker for functional tests
    networks:
      - startupwebapp
    # Keep container running without starting server (allows functional tests to use port 60767)
    # Commented out to enable normal development - Django starts via Dockerfile CMD
    # command: tail -f /dev/null
    stdin_open: true
    tty: true

  frontend:
    image: nginx:alpine
    container_name: startupwebapp-frontend-dev
    ports:
      - "8080:80"  # Frontend accessible at port 8080 on host
    volumes:
      # Mount frontend static files
      - ../startup_web_app_client_side:/usr/share/nginx/html:ro
      # Mount custom nginx configuration for extensionless HTML files
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - startupwebapp
    depends_on:
      - backend

volumes:
  sqlite_data:
    driver: local

networks:
  startupwebapp:
    driver: bridge
